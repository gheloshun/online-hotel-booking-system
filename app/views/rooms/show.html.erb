<div class="row">
  <div class="col l8">
    <div class="row room-details-container">
      <%= @room.room_number %>
      <div class="carousel carousel-slider center">
        <% (0...@room.images.count).each do |image| %>
        <div class="carousel-item">
          <div class="row">
            <%= image_tag @room.images[image] %>
          </div>
        </div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="col l4">
    <div class="row book-details">
      <%= to_two_decimal(@room.room_rate) %>
    </div>
    <%= form_for @booking do |f| %>
      <div class="row book-details">
        <div class="col l6">
          <%= f.label "Check-in" %>
          <%= f.text_field :check_in, class: "datepicker_from" %>
        </div>
        <div class="col l6">
          <%= f.label "Check-out" %>
          <%= f.text_field :check_out, class: "datepicker_to" %>
        </div>
      </div>
      <p class="book-details">
        <%= f.select :number_of_guest, count_max_capacity %>
      </p>
      <div class="">
      </div>
      <div class="row book-details">
        <div class="col l6 left">
          <%= f.label :room_rate %>
          <%= f.text_field :room_rate, value: current_room.room_rate, class: "room_rate" %>
          <br>
          <%= f.label :number_of_night %>
          <%= f.text_field :number_of_night, class: "total_days" %>
          <br>
          <%= f.label :sub_total %>
          <%= f.text_field :sub_total, value: 0, class: "sub_total" %>
          <br>
          <%= f.label :cleaning_fee %>
          <%= f.text_field :cleaning_fee, value: current_room.cleaning_fee, class: "cleaning_fee" %>
          <br>
          <%= f.label :service_fee %>
          <%= f.text_field :service_fee, value: current_room.service_fee, class: "service_fee" %>
          <br>
          <%= f.label :total_bill %>
          <%= f.text_field :total_bill, class: "total_bill" %>
        </div>

      </div>
      <div class="row book-details">
        <%= f.submit "Book", class: "waves-effect waves-light btn red" %>
      </div>
    <% end %>
  </div>
</div>

<script type="text/javascript">
  $('.carousel.carousel-slider').carousel({
    fullWidth: true,
    indicators: true
  });

  $(document).ready(function(){
    var today = new Date();
    var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();

    $('.datepicker_to').datepicker({
      minDate: new Date(date),
      autoClose: true,
      onSelect: function(){
        var d1 = $('.datepicker_from').val();
        var d2 = $('.datepicker_to').val();
        var date1 = new Date(d1);
        var date2 = new Date(d2);
        var date1_ms = date1.getTime();
        var date2_ms = date2.getTime();
        var diff = date2_ms-date1_ms;
        var days = diff/1000/60/60/24;
        $('.total_days').val(days);

        var roomRate = parseFloat($('.room_rate').val());
        var numNight = parseFloat($('.total_days').val());
        var cleanFee = parseFloat($('.cleaning_fee').val());
        var serviceFee = parseFloat($('.service_fee').val());
        var subTotal = parseFloat($('.sub_total').val());
        var total = 0.00
        subTotal = roomRate * numNight;
        total = subTotal + cleanFee + serviceFee;

        $('.sub_total').val(subTotal.toFixed(2));
        $('.total_bill').val(total.toFixed(2));
      }
    });
  });

  $(document).ready(function(){
    var today = new Date();
    var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
    $('.datepicker_from').datepicker({
      minDate: new Date(date),
      autoClose: true,
      onSelect: function(){
        var d1 = $('.datepicker_from').val();
        var d2 = $('.datepicker_to').val();
        var date1 = new Date(d1);
        var date2 = new Date(d2);
        var date1_ms = date1.getTime();
        var date2_ms = date2.getTime();
        var diff = date2_ms-date1_ms;
        var days = diff/1000/60/60/24;
        $('#total_days').text(days);
      }
    });
  });

  $(document).ready(function(){
    $('select').formSelect();
  });

</script>
